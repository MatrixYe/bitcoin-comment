---
title: Bitcoin P2P e-cash paper
date: 2025-11-15 10:43:34
updated: 2025-12-02 12:17:12
tags: [比特币, email]
source: https://satoshi.nakamotoinstitute.org/emails/cryptography/threads/1/
email-id: 1
email-group: Cryptography Mailing List
email-date: 2008-10-31T18:10:00
---

```markdown
---
title: Bitcoin P2P e-cash paper
date: 2025-11-15 10:43:34
updated: 2025-12-02 12:17:12
tags: [比特币, email]
source: https://satoshi.nakamotoinstitute.org/emails/cryptography/threads/1/
email-id: 1
email-group: Cryptography Mailing List
email-date: 2008-10-31T18:10:00
---
```
## 中本聪：发布比特币白皮书
2008 年 10 月 31 日
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 10 月 31 日 18:10:00（UTC)
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/1/)

我一直在研究一种全新的电子现金系统，它是完全点对点的，无需任何可信第三方。
相关论文可在以下网址获取：<http://www.bitcoin.org/bitcoin.pdf>
其主要特性包括：
- 通过点对点网络防止双重支付；
- 不存在铸币厂或其他可信机构；
- 参与者可以匿名；新币通过类似 Hashcash 的工作量证明机制产生；
- 新币生成所采用的工作量证明机制同时也为网络防止双重支付提供了动力。

《比特币：一种点对点的电子现金系统》摘要：纯点对点版本的电子现金可以让在线支付直接从一方发送到另一方，无需经过金融机构，从而摆脱由此带来的负担。数字签名提供了部分解决方案，但如果仍需要一个可信第三方来防止双重支付，那么其主要优势就荡然无存了。我们提出了一种利用点对点网络解决双重支付问题的方案。该网络通过将交易哈希到一条持续增长的、基于哈希的工作量证明链中，为交易添加时间戳，形成一个除非重新完成工作量证明否则无法更改的记录。最长的链条不仅是所见证事件序列的证明，也是其来自最大 CPU 算力池的证明。只要诚实节点控制着网络中最多的 CPU 算力，它们就能生成最长的链条，并超越任何攻击者。该网络本身只需要最少的结构。消息以最大努力的方式进行广播，节点可以随意离开和重新加入网络，在离开期间发生的事情则以最长的工作量证明链作为证明。完整论文请见：<http://www.bitcoin.org/>

发件人：詹姆斯·A·唐纳德主题：比特币点对点电子现金论文日期：2008 年 11 月 2 日世界标准时间 23:46:23

## 詹姆斯·A·唐纳德：对可扩展性的担忧
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 2 日世界标准时间 23:46:23
原文：[Bitcoin P2P e-cash paper](https://www.metzdowd.com/pipermail/cryptography/2008-November/014814.html)

我们非常、非常需要这样一个系统，但根据我对您提案的理解，它似乎无法扩展到所需的规模。
为了让可转移的工作量证明代币具有价值，它们必须具备货币价值。而要具备货币价值，它们必须在一个非常庞大的网络中进行转移——例如，一个类似于比特流（bittorrent）的文件交易网络。为了及时检测并拒绝双重支付事件，必须掌握该交易中涉及的代币的大部分过往交易记录。如果采用简单的实现方式，这就要求每个节点都拥有大部分过往交易记录，或者是大部分近期发生的交易记录。如果有数亿人进行交易，那将需要大量的带宽——每个节点都必须了解所有交易，或者其中的很大一部分。

## 中本聪答唐纳德：用 SPV 解决带宽问题
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 3 日世界标准时间 01:37:43
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/2/)

在网络远未发展到那种规模之前，用户使用简化支付验证（第 8 节）来检查双重支付就是安全的，这只需要拥有区块头链，每天大约 12KB 的数据量。只有那些试图创建新币的人才需要运行网络节点。起初，大多数用户会运行网络节点，但随着网络规模超过某个临界点，运行节点的任务会越来越多地落到拥有专业硬件服务器集群的专业人员身上。一个服务器集群只需在网络上有一个节点，局域网内的其他设备都与这个节点相连。
带宽问题可能并不像你想象的那么难以解决。一笔典型的交易大约为 400 字节（椭圆曲线加密算法非常紧凑）。每笔交易需要广播两次，所以我们按每笔交易 1KB 来算。VISA 在 2008 财年处理了 370 亿笔交易，平均每天 1 亿笔。这么多交易将占用 100GB 的带宽，相当于 12 张 DVD 的容量，或者 2 部高清电影的大小，按当前价格计算，带宽成本约为 18 美元。
如果网络要发展到那种规模，那需要好几年的时间，到那时，通过互联网发送 2 部高清电影可能就不算什么大事了。

## 约翰·莱文：僵尸网络的威胁怎么办
发件人：约翰·莱文
主题：比特币点对点电子现金论文
日期：2008 年 11 月 3 日 UTC 13:32:39
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014817.html)

但事实并非如此。坏人通常控制着拥有 10 万台甚至更多机器的僵尸网络农场。我认识一些运营垃圾邮件发送僵尸网络黑名单的人，他们告诉我，他们经常每天能看到 100 万个新的僵尸网络节点。这也是哈希现金（hashcash）在当今互联网上无法奏效的相同原因——好人拥有的计算能力远不如坏人。我对其他问题也有疑虑，但这个问题是致命的。

## 中本聪回答约翰：诚实算力压倒攻击者
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 3 日 16:23:49（UTC）
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/3/)

感谢你提出这一点。
我确实没有把这个说法表达得尽可能有力。要求是好人集体拥有的 CPU 算力要超过任何单个攻击者。
会有许多规模较小的僵尸网络农场，它们的规模不足以压制网络，但仍然可以通过生成比特币来赚钱。这些较小的农场就是“诚实节点”（我需要一个比“诚实”更好的术语）。越多的小农场转而生成比特币，压制网络的门槛就越高，这会使得较大的农场也变得太小而无法压制网络，因此它们也不妨转而生成比特币。根据“长尾”理论，小型、中型和只是较大型的农场加起来，其总量应该远远超过最大的僵尸网络农场。
即使有坏人真的压制了网络，他也不会瞬间变得富有。他所能做到的，只是拿回自己花出去的钱，就像拒付支票一样。要利用这一点，他得从商家那里买东西，等东西发货后，再压制网络并试图拿回自己的钱。我认为，通过这种类似信用卡诈骗的手段，他能赚到的钱并不如通过生成比特币多。拥有那么大的僵尸网络农场，他生成的比特币可能会超过其他所有人的总和。比特币网络实际上可能会通过将僵尸网络农场转移到生成比特币的业务上，来减少垃圾邮件。

## 唐纳德：政治问题与闪电网络雏形
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 3 日世界标准时间 20:20:13
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014819.html)

### 政治问题的解决方案令人绝望
如果我对简化支付验证的理解是正确的：新的货币发行者需要存储所有货币以及所有近期的货币转账记录。新的货币发行者数量众多，只要有人想成为发行者就可以，而货币使用者的数量则要多得多。普通主体仅进行货币转账。要判断一笔货币转账是否可行，他们会将其报告给一个或多个新的货币发行者，看这些发行者是否接受。新的货币发行者会检查旧货币的转账情况，以确保他们发行的新货币形式有效，并且他们会公布检查结果，这样人们才会将自己的转账情况报告给这些新发行者。

如果有人对某一货币进行双重花费，其中一笔支出被报告给一个新的货币发行者，而另一笔同时被报告给另一个新的货币发行者，那么这两个发行者需要迅速就支付的唯一顺序达成一致。然而，这是一个大规模分布式海量数据库所面临的非 trivial 问题，是一个出了名的棘手问题，目前尚无对等网络解决方案。显然，这是一个可以解决的问题，人们一直在解决它，但绝非易事。人们在解决这个问题时失败的情况更为常见。

不过，让我们假设货币发行网络像看起来可能的那样，由少数发行者主导。如果只有少数实体发行新货币，那么与单一发行者相比，它更能抵御国家的攻击，但政府会定期攻击金融网络，在我写下这些文字时，最近一次攻击引发的金融崩溃仍在持续。

政府支持的企业进入这一领域，久而久之，不良行为变得合法化，邪恶的金融网络规模超过了诚信的金融网络。结果是，尽管每个人都知道正在发生什么，但由于网络效应，人们仍然继续使用邪恶金融网络发行的票据——如果你想做生意，就得使用那些大型的、主要的发行者所发行的票据。

然后，有见识的人会抱怨这个邪恶的金融网络正走向灾难，政府支持的企业即将引发 “整个金融体系的崩溃”，就像沃利森和艾伦・格林斯潘在 2005 年所抱怨的那样。政府会讨论缩减这些邪恶的政府支持企业的规模，比如通过《2005 年联邦住房企业监管改革法案》（S. 190 [第 109 届]），但他们发现宽松的货币政策太具诱惑力，S. 190 最终在一群政治活动家的声讨中夭折。这些活动家高呼宽松的货币政策是合理的，而反对它的人是种族主义者、纳粹分子、无知者，总体上是可恨的。最近关于限制政府支持企业投资组合（支持不良抵押贷款的债券发行）的 S. 190 辩论，完美地重现了 18 世纪 90 年代关于限制新指券发行的辩论。

政府对货币的重大且轻易的攻击，其目标是单一的中央货币发行者，就像现代政治攻击中的首次案例——1792 年的法国指券。但在 19 世纪末，对金融网络的政治攻击开始了，例如 1913 年的《联邦储备法》。其目标始终是将网络整合为一个 “大到不能倒” 的单一实体，而且这些攻击规模越来越大、越来越严重、造成的灾难也越来越大，最近的一次攻击就是如此。每次攻击都取得了巨大的 “成功”，在攻击引发灾难之后，攻击者被赞为穷人、受压迫者以及整个国家的救星，而不良后果的责任则被推给其他方面，通常是犹太人、贪婪的银行家、投机者等，因为普通民众很难理解这类攻击。

我很难理解你的提议——普通用户很容易被政府支持的 “安全更新” 所欺骗。此外，当危机来临时，反对官方说法、质疑监管机构的正确性以及认为问题出在邪恶的投机者身上，这会成为政治自杀，就像 2007 年在美国那样，有时甚至是物理上的自杀，就像魏玛德国时期那样。

尽管如此，与我迄今为止所见过的任何方案相比，你的提议还是更好，更能抵御政府支持企业的攻击。

### 闪电网络的雏形
如果到政府发起攻击时，已经有一百或一千个货币发行方，那么我们最近看到的那种政府对金融网络的攻击很可能会变得更加困难。但我认为，我们需要致力于减少货币发行方所需的数据和带宽——对于小额货币而言，该协议似乎有些浪费。要是大额货币采用完整协议，而小额货币能有某种捷径就好了，即人们在小额交易中信任基于账户的货币，直到这些小额货币汇总成大额货币为止。货币发行方所需的数据存储和带宽越小，该系统就越能抵御我们最近看到的那种政府对金融网络的攻击。

## 迪林格：比特币高通胀注定是没有市场
发件人：雷・迪林格
主题：比特币点对点电子现金论文
日期：2008 年 11 月 6 日世界协调时间 05:14:37
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014822.html)

我认为这个系统真正的问题在于比特币的市场。计算工作量证明没有内在价值。我们可以有一条有限的供给曲线（尽管这种 “货币” 的通胀率约为 35%，因为计算机的运算速度每年大约就快这么多），但不存在一条能在正价格点与之相交的需求曲线。

我知道法定货币也存在同样的问题（缺乏内在价值），但法定货币的人为需求是由税收和法定货币法等因素创造出来的。此外，即使是法定货币，也可以作为一种通胀对冲工具，抵御另一种法定货币更高的通胀率。

但就比特币而言，35% 的通胀率几乎是由技术决定的，它没有税收的支持机制，也没有法定货币法。如果可以的话，人们不会持有这种高通胀货币形式的资产。

## 中本聪答唐纳德：p2p 网络才能守卫我们的自由
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 6 日世界标准时间 20:15:40
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/4/)

是的，但我们能够在这场军备竞赛中赢得一场重要战役，并在未来数年赢得一片新的自由领地。政府擅长砍掉像 Napster 这类中央控制网络的头部，但像 Gnutella 和 Tor 这样纯粹的点对点网络似乎能坚守阵地。

## 芬尼：肯定与深入提问
发件人：哈尔・芬尼
主题：比特币点对点电子现金论文
日期：2008 年 11 月 7 日 23:40:12
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014827.html)

比特币似乎是一个非常有前景的想法。我喜欢将安全性建立在诚实参与者的 CPU 算力超过攻击者这一假设之上的理念。这是一种非常现代的观念，它利用了 “长尾效应” 的力量。维基百科刚起步时，我从未想过它会成功，但出于一些相同的原因，它已被证明取得了巨大的成功。

我也确实认为，一种不可伪造的代币形式具有潜在价值，其产出速度可预测，且不会受到腐败方的影响。这更类似于黄金，而非法定货币。尼克・萨博多年前曾写过关于他所谓的 “比特金”[1] 的内容，而比特币或许就是这一概念的一种实现。也有一些提案建议在重量级的非匿名系统之上构建轻量级的匿名支付方案，因此，比特币或许能被利用来实现匿名性，甚至超越论文中所讨论的机制。

遗憾的是，我难以完全理解这个系统。论文描述了关键概念和一些数据结构，但没有清晰地说明系统参与者必须遵循的各种规则和验证流程。

具体来说，我不太清楚 P2P 节点在从其他节点接收新块时会执行哪些验证，以及它们如何处理已广播的交易。例如，论文中提到，如果一笔广播的交易没有到达所有节点，也没关系，因为它很快就会进入区块链。这是如何实现的呢？如果创建 “下一个” 区块（第一个找到哈希现金碰撞的节点）的节点没有收到这笔交易，之后又有几个区块是由没有收到这笔交易的节点添加的，那会怎样？是不是所有收到这笔交易的节点都会保留它，期待着一旦自己足够幸运能找到下一个碰撞时，就把它纳入某个区块中？

再比如，如果一个节点在等待观察哪条链增长最快时，同时保留着两条或更多条链，而此时一条针对 A 链的区块传来，其中包含了对 B 链中某枚硬币的双重花费，这种情况会被检查吗？（如果有人进行双重花费，且两组不同的节点分别收到了同一枚硬币的两笔不同交易，就可能出现这种情况。）

这类数据管理以及处理所有流转数据包的规则，在论文中大多没有涉及。

我也不太明白，一个能够集结超过所有诚实参与者算力的高级攻击者，是如何实现双重花费或取消交易的。我知道他可以创建新的区块并将其添加进去，以形成最长的链，但他怎么能删除或添加链中旧的交易呢？当攻击者发出他的新区块时，诚实的节点难道不会执行一致性检查，以确保没有交易被删除吗？对这种攻击进行更多的解释会很有帮助，这样才能判断攻击者从中获得的收益，与单纯用其算力诚实挖矿相比孰优孰劣。

至于花费交易，硬币的接收方需要执行哪些检查呢？她是否需要追溯这枚硬币的整个转账历史，确保列表上的每一笔交易都确实链接到 “时间戳” 区块链中？还是说她只需检查最新的一笔交易？时间戳节点会检查交易，确保某枚硬币的上一笔交易在链中，从而执行链中所有交易都代表有效硬币这一规则吗？

很抱歉问了这么多问题，但正如我所说，这确实是一个非常有前景且新颖的想法，我期待看到这个概念能得到进一步发展。如果能有一个更侧重于流程的描述，包括各种对象（硬币、区块、交易）的数据结构的具体细节、消息中包含的数据，以及处理系统中可能发生的各种事件的流程的算法描述，将会很有帮助。你提到正在进行实现工作，但我认为对该系统进行更正式的文字描述会是有益的下一步。

## 中本聪答芬尼：代码先行，细节后补
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 8 日 18:54:38（世界协调时间）
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/5/)

哈尔・芬尼写道：
> 文中提到，如果一笔广播交易没有到达所有节点，这也没关系，因为它很快就会进入区块链。这是如何实现的呢？如果创建 “下一个” 区块（第一个找到哈希现金碰撞的节点）的节点没有收到这笔交易，而且之后又有几个区块是由没有收到这笔交易的节点添加的，那该怎么办？是不是所有收到这笔交易的节点都会保留它，希望在足够幸运地成为下一个找到碰撞的节点时，能把它纳入区块中？

没错，节点会把交易保留在自己的工作集中，直到交易被纳入某个区块。如果一笔交易到达了 90% 的节点，那么每次有新区块生成时，这笔交易被纳入其中的概率就是 90%。

> 再举个例子，如果一个节点在等待看哪条链增长得最快时，同时保留着两条或更多条链，而此时针对链 A 的一个区块传来，其中包含了对链 B 中某笔 coins 的双重花费，这种情况会被检查吗？（如果有人进行双重花费，且两组不同的节点分别收到了同一 coins 的两笔不同交易，就可能出现这种情况。）

这种情况无需检查。最终哪条分支领先，其中的交易就会成为有效的，另一条分支中的则无效。如果有人尝试这样进行双重花费，始终只会有一笔花费有效，其他的则无效。交易的接收方通常需要将交易保留一小时左右，以便这类可能出现的问题得到解决。他们可以立即重新花费这些 coins，但在采取发货等行动之前，最好先等待一段时间。

> 我也不太明白，一个能够集结比所有诚实参与者都更强算力的超级攻击者，是如何实现双重花费或取消交易的。我知道他可以创建新的区块并添加进去，以形成最长的链，但他怎么能删除或添加链中旧的交易呢？当攻击者发布他的新区块时，诚实的节点难道不会进行一致性检查，以确保没有交易被删除吗？对这种攻击进行更详细的解释会很有帮助，这样才能判断攻击者从中能获得的收益，与单纯用自己的算力诚实挖矿相比孰高孰低。

攻击者并不是在链的末端添加区块。他必须回溯，重新计算包含他那笔交易的区块以及该区块之后的所有区块，同时还要处理在他进行这些操作时，网络不断往链末端添加的新区块。他这是在改写历史。一旦他的分支变得更长，就会成为新的有效链。这涉及到一个关键点。即便在场的所有人都可能看到正在发生的欺诈行为，也无法利用这一事实。最长的链必须始终被视为有效链，这是毋庸置疑的。在场的节点可能会记得某条分支先出现，后来被另一条分支取代，但它们无法向不在场的节点证明这一点。我们不能让一部分节点执着于它们认为先出现的那条分支，另一部分节点坚持自己先看到的另一条分支，还有一些后来加入的节点完全不清楚发生过什么。CPU 算力的工作量证明投票必须拥有最终决定权。让所有人达成共识的唯一方法，就是坚信无论何种情况，最长的链始终是有效链。

> 至于花费交易，coins 的接收方需要进行哪些检查呢？她是否需要追溯该 coins 的整个转账历史，确保列表上的每一笔交易都确实链接到 “时间戳” 区块链中？还是说她只需要检查最新的一笔交易就行？

接收方只需将验证追溯到区块链中足够靠后的深度，通常只需要追溯 2 笔交易的深度即可。在此之前的所有交易都可以丢弃。

> 时间戳节点会检查交易吗？比如确保某笔 coins 的上一笔交易在链中，从而执行链中所有交易都代表有效 coins 这一规则？

是的，确实会检查。当节点收到一个区块时，会对照区块中之前的交易，检查该区块内每笔交易的签名。区块只能包含依赖于前序区块或同一区块中有效交易的交易。例如，交易 C 可能依赖于同一区块中的交易 B，而交易 B 又依赖于前序区块中的交易 A。

> 很抱歉问了这么多问题，但正如我所说，这确实是一个非常有前景且新颖的想法，我很期待看到这个概念如何进一步发展。如果能有一个更侧重于流程的描述，包括各种对象（coins、区块、交易）的数据结构细节、消息中包含的数据，以及处理该系统中可能发生的各种事件的算法描述，会很有帮助。你提到正在进行实现工作，但我认为接下来对该系统进行更正式的文字描述会很有益处。

感谢你的提问。实际上，我的做法有点本末倒置。我得先写完所有代码，才能确信自己能解决所有问题，然后才写了这篇论文。我想，我发布代码的时间可能会比写出详细规范的时间更早。你在自行补充的那些假设中，大部分都是正确的。

## 中本聪答唐纳德：工作量证明链是同步问题的解决方案
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 9 日世界标准时间 03:09:49
原文：

詹姆斯・A・唐纳德写道：
> 核心概念是，许多实体都保存着关于谁拥有哪些比特币的完整且一致的信息。
> 但维持一致性并非易事。我不清楚，当有人向一个维护者报告一笔交易，而另一个人向另一个维护者传递另一笔交易时，会发生什么情况。只有当交易被纳入所有过往交易的全球共享视图后，它才能被视为有效；而且，只有在一段时间过去、许多新交易到达之后，人们才能确定这个所有过往交易的全球共享视图确实是全球共享的。
> 是你解释过如何做到这一点，而我没注意到，还是你确信这是可以做到的，但在细节上有些模糊呢？

工作量证明链是同步问题的解决方案，它能让我们在无需信任任何人的情况下，知晓全球共享视图是什么。
一笔交易会迅速在网络中传播，因此，如果同一笔交易的两个版本几乎同时被报告，先发起的那个版本将在率先到达更多节点方面拥有巨大优势。节点只会接受它们首先看到的那个交易，拒绝后到达的第二个，因此较早的交易将有更多节点致力于将其纳入下一个工作量证明中。实际上，每个节点通过将自己首先看到的交易纳入工作量证明工作中，为自己的观点 “投票”。
如果两笔交易确实同时到达，并且节点对它们的接受情况各占一半，那么哪一笔能先进入工作量证明就全凭运气了，而这也决定了哪一笔是有效的。
当某个节点找到一个工作量证明时，新的区块会在整个网络中传播，所有人都会将其添加到链上，并开始在它之后的下一个区块上工作。任何拥有另一笔交易的节点都会停止尝试将其纳入区块，因为根据已被接受的链，它现在已经无效了。
工作量证明链本身就是其源自全球共享视图的不言而喻的证明。只有网络中的大多数节点联合起来，才拥有足够的 CPU 算力来生成如此难以构建的工作量证明链。任何用户在收到工作量证明链后，都能看到网络大多数节点所认可的内容。一旦一笔交易被哈希到链中几个链接之前的某个链接里，它就被牢牢地铭刻在全球历史中了。

## 唐纳德：与银行卡网络的竞争
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 9 日世界标准时间 04:55:23
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014834.html)

中本聪写道：
> 带宽可能并不像你想象的那样令人望而却步。一笔典型的交易大约为 400 字节（椭圆曲线加密法非常紧凑）。每笔交易必须广播两次，所以我们假设每笔交易为 1KB。维萨在 2008 财年处理了 370 亿笔交易，也就是平均每天 1 亿笔交易。这么多交易将占用 100GB 的带宽，相当于 12 张 DVD 或 2 部高清电影的大小，按当前价格计算，带宽成本约为 18 美元。

问题在于，你是在与银行卡网络进行比较。但一种新货币无法直接与旧货币竞争，因为网络效应有利于旧货币。你必须去银行卡无法触及的领域。
目前，文件共享通过比特的物物交换来实现。然而，这需要需求的双重巧合。人们只上传他们正在下载的文件，一旦下载完成，就停止做种。因此，只有活跃的文件，也就是很多人同时想要的文件，才是可获取的。
文件共享需要极其低廉的交易，每个客户端每秒都要进行几笔交易，日复一日，且每个客户端的月度交易成本非常低。因此，要在比特币上支持文件共享，我们需要在比特币之上建立一层账户货币，以支持最小货币单位的十万分之一规模的交易；并且为了支持匿名性，在账户货币之上再建立一层乔姆货币。
我们不妨将比特币银行称为 “bink”。比特币与账户货币的关系，就如同金本位时代黄金与货币的关系。由于互不信任对方在最需要流动性的时候是否具备流动性，这些 “bink” 大约每 10 万秒会通过转移比特币来结算彼此之间的任何净差额，因此比特币不会频繁更换所有者。大多数交易在账户层面就相互抵消了。这些 “bink” 之所以要求对方用比特币结算，只是因为它们不想持有账户货币太久。所以，相对少量且不常交易的比特币，能够支撑规模稍大且频繁交易的账户货币。

## 唐纳德：如果同时生成两个区块
发件人：詹姆斯·A·唐纳德】
主题：比特币点对点电子现金论文
日期：2008 年 11 月 9 日世界协调时间 08:56:53
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014835.html)

中本聪写道：
> 工作量证明链是同步问题的解决方案，它能让我们在无需信任任何人的情况下，知晓全球共享的视图是什么。
> 一笔交易会迅速在整个网络中传播，所以如果同一笔交易的两个版本几乎同时被报告，先开始传播的那个版本将在率先到达更多节点方面拥有巨大优势。节点只会接受它们首先看到的那个版本，拒绝后到达的第二个版本，因此较早的交易将会有更多节点致力于将其纳入下一个工作量证明中。实际上，每个节点通过将自己首先看到的交易纳入其工作量证明工作中，来为自己的观点 “投票”。

好的，假设一个节点在其工作量证明中纳入了一批交易，所有这些交易都是诚实合法的单次花费；另一个节点在其工作量证明中纳入了一批略有不同的交易，所有这些交易也同样是诚实合法的单次花费，而且这两个证明几乎是同时生成的。
那么会发生什么呢？

## 唐纳德：铸币税与通胀难题
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 9 日，世界协调时间 10:05:05
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014838.html)

中本聪写道：
> 硬件速度的提升是这样处理的：“为了应对硬件速度的不断提升以及随着时间推移人们对运行节点的兴趣变化，工作量证明的难度由一个移动平均值决定，其目标是每小时生成平均数量的区块。如果区块生成得太快，难度就会增加。”

这是行不通的——你的提案存在一些复杂问题，我认为你并没有充分考虑到。此外，这一方案根本无法实现，因为在你所提议的系统中，追踪谁拥有哪些代币的工作是通过铸币税来支付的，而这需要通货膨胀。不过，这并非一个无法容忍的缺陷——可预测的通货膨胀，要比那些时不时被操纵以将财富从一个投票群体转移到另一个投票群体的通货膨胀更易被接受。

## 中本聪答唐纳德：分叉那你就等一会嘛
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 9 日 16:31:26（世界协调时间）
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/8/)

詹姆斯・A・唐纳德写道：

> 好的，假设一个节点在其工作量证明中包含了一系列交易，所有这些交易都是诚实、合法的单次花费，而另一个节点在其工作量证明中包含了另一系列不同的交易，所有这些交易也同样是诚实、合法的单次花费，并且两个证明几乎是同时生成的。
> 那么会发生什么情况呢？

它们都会广播自己的区块。所有节点都会收到这两个区块并将它们都保存下来，但只会基于自己先收到的那个区块进行工作。我们假设正好一半的节点先收到了其中一个区块，另一半节点先收到了另一个。在短时间内，所有交易都会完成传播，这样每个人都拥有了完整的交易集合。在各自分支上工作的节点会尝试添加各自分支中缺失的交易。当找到下一个工作量证明时，无论该节点之前在哪个区块上工作，那个分支都会变得更长，平局也就此打破。无论哪一方获胜，新的区块都会包含另一半的交易，所以无论哪种情况，这个分支都会包含所有交易。即便在不太可能发生的情况下，连续出现两次分叉，第二次分叉的双方也都会包含完整的交易集合。
交易需要多等待一个或几个周期才能进入区块，这并不是什么问题。

## 唐纳德：失败者的币怎么办？
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 9 日 19:57:54
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014841.html)

> 詹姆斯・A・唐纳德写道：
> > 好的，假设一个节点在其工作量证明中包含了一系列交易，所有这些交易都是诚实、合法的单次花费，而另一个节点在其工作量证明中包含了另一系列不同的交易，所有这些交易也同样是诚实、合法的单次花费，并且两个证明几乎是同时生成的。
> > 那么会发生什么呢？
> 中本聪写道：
> > 它们都会广播自己的区块。所有节点都会接收到这些区块并将两者都保留下来，但只在自己先收到的那个区块的基础上继续工作。我们假设正好一半的节点先收到其中一个区块，另一半节点先收到另一个。很快，所有交易都会完成传播，这样每个人都拥有了完整的交易集。在各自分支上工作的节点会尝试添加自己分支中缺失的交易。当找到下一个工作量证明时，无论该节点之前在哪个区块上工作，那个分支都会变得更长，平局也就此打破。无论哪一方，新的区块都会包含另一半的交易，所以无论哪种情况，这个分支都会包含所有交易。即便在不太可能发生的情况下，连续出现两次分叉，第二次分叉的双方也都会包含完整的交易集。如果交易需要多等一个或几个周期才能进入区块，这并不是什么问题。

那么，在这场竞争中失败的那枚币会怎么样呢？
一方面，我们希望那些生成币的人有动力去保存和记录所有交易，并及时获取所有交易的最新记录。另一方面，如果排名第二的人很可能会失去他的币，这就有点苛刻了。
此外，你对事件的描述暗示了在时间和币的生成方面存在限制——整个网络生成币的速度要比新币消息在网络中传播所需的时间慢，否则链条会越来越分散，没人能知道哪条链条是胜出者。
你需要明确这些限制，因为网络传播时间很可能会相当慢。这意味着新币的生成速度会更慢。
我们希望支付者能在花费信息在网络中传播所需的时间内，就确定自己的交易是有效的，而不是要等到分支竞争的结果出来。
在任何特定时间，例如在 1040689138 秒时，我们可以回顾过去并说：
在 1040688737 秒时，节点 5 是 “那个节点”，它将自己发现的所有币都纳入了链条中，并且将自己知道的所有新交易都添加到了前一个链接的上面。
在 1040688792 秒时，节点 2 是 “那个节点”，它将自己发现的所有币都纳入了链条中，并且将自己知道的所有新交易都添加到了节点 5 的链接上面的链条中。
在 1040688745 秒时，节点 7 是 “那个节点”，它将自己发现的所有币都纳入了链条中，并且将自己知道的所有新交易都添加到了节点 2 的链接上面的链条中。
但现在没人能知道谁是 “那个节点”。
那么，一个人该如何知道何时公布自己的币呢？一种解决方案是不需要公布。每当一个人认为自己可能是 “那个节点” 时，就将币的秘密的哈希值纳入其中，在该哈希值安全地进入链条后，在知道自己当时确实是 “那个节点” 后，就可以安全地花费自己找到的币，并公布这个秘密。
这个解决方案解决了币的公布问题，但没有解决花费记录问题。如果一个节点无视所有自己不关心的花费，它不会受到任何不利影响。我们需要一种协议，在这种协议中，你成为 “那个节点” 的可能性还取决于其他节点是否认为你拥有相对新且完整的花费列表——而目前这个协议不是这样的，你的协议也不是。

## 中本聪答唐纳德：没有奖励的话，铸币费可以由手续费支付
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 10 日 02:14:30
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/9/)

> 詹姆斯・A・唐纳德写道：
> > 此外，这是行不通的，因为在拟议的系统中，追踪谁拥有哪些硬币的工作是通过铸币税来支付的，而这需要通货膨胀。

如果你对通货膨胀问题有疑虑，很容易将其调整为交易费模式。方法很简单：让任何交易的输出值比输入值少 1 美分。要么客户端软件自动将交易金额写成比预期支付金额多 1 美分，要么这 1 美分从收款方扣除。当节点为一个区块找到工作量证明时，其激励价值可以是该区块内的总交易费。

## 中本聪答唐纳德: 6 个区块确认准则
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 10 日世界标准时间 22:18:20
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/10/)

> 詹姆斯・A・唐纳德写道：
> 那么，那场竞赛中输掉的代币会怎么样呢？
> …… 如果那个获得第二名的人可能会失去他的代币，这有点太苛刻了。

当同一笔交易存在多个双花版本时，只有其中一个会变得有效。付款的接收方必须等待大约一个小时才能相信交易是有效的。到那时，网络将解决任何可能的双花竞赛问题。收到变得无效的双花交易的人从一开始就不会认为自己真正拥有过这笔钱。他的软件会显示该交易从 “未确认” 变为 “无效”。如有必要，用户界面可以设置为在交易在区块链中达到足够深度之前不显示它们。

> 詹姆斯・A・唐纳德写道：
> 此外，你对事件的描述暗示了对时间安排和代币生成的限制——整个网络生成代币的速度，相较于新代币信息在网络中传播所需的时间来说，要慢一些。

抱歉，我之前没说清楚。区块之间的目标时间间隔可能会是 10 分钟。
每个区块都包含其创建时间。如果时间误差超过 36 小时，其他节点就不会处理这个区块。如果过去 6×24×30 个区块的时间跨度少于 15 天，说明区块生成速度过快，工作量证明的难度就会翻倍。每个人都用相同的链数据进行相同的计算，所以他们在链中的同一个节点处会得到相同的结果。

> 詹姆斯・A・唐纳德写道：
> 我们希望付款人在付款信息在网络中传播所需的时间内，就能确定他们的交易是有效的，而不是要等到分支竞赛得到解决的时候。

即时不可否认性并非该系统的特性，但它仍然比现有的系统快得多。纸质支票可能在一到两周后被退票。信用卡交易在 60 到 180 天内都可能被异议。而比特币交易在一到两个小时内就基本能达到不可逆转的状态。

> 詹姆斯・A・唐纳德写道：
> 如果一个节点忽略所有它不关心的支出，它不会受到任何不利影响。

有了我最近发布的基于交易费的激励机制，节点会有动力将其收到的所有付费交易都包含进来。

## 唐纳德：我还是怀疑你的系统是否能真的抵御共识攻击
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 13 日世界标准时间 06:16:31
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014847.html)

> 中本聪写道：
> 当同一笔交易存在多个双重花费版本时，只有其中一个会生效。

这并非我所问的问题。我担心的不是信任问题，而是即便所有人都行为端正，如何才能形成一个全球共享的视图。

关于如何达成谁拥有哪些比特金硬币这一全球共享视图的流程，其规定尚不充分。只有明确了这一点，我们才能开始考虑每个人是否有动力规范行事。
仅仅让每个人都知道 X 是不够的。我们还需要让每个人都知道其他人都知道 X，并且每个人都知道其他人都知道每个人都知道 X——这就如同拜占庭将军问题一样，是分布式数据处理中一个典型的难题。当 X 可能是大量数据时，这个问题会变得更加棘手，比如要就某个时间点每枚比特金硬币的所有者达成一致。

除此之外，我们还需要让每个人都有动力以促成共识的方式行事。在我不知道需要激励何种行为的情况下，我看不到他们有这样的动力。你一直在重复分析系统遭受攻击时的情况。在我们弄清楚系统在未受攻击时应该如何运行之前，根本无法谈论系统在遭受攻击时会有怎样的表现。如果存在大量交易，就很难高效地发现不同节点视图之间的差异，而且由于新交易不断涌入，即便所有节点都是诚实的，所有上报的交易都是正确且真实的单次花费，也没有两个节点会拥有完全相同的视图。

我们应当能够构建一个系统，让两个节点在不久前的某个时间点上，就谁拥有哪些比特金硬币达成一致，但这并非易事。如果一个节点生成了一个哈希值，该哈希值代表了它对某个特定时间点谁拥有哪些比特金硬币的认知，而另一个节点想要验证这个哈希值，要以一种容易达成一致、且能高效检测并解决诚实合规节点之间分歧的方式来做这件事，并非易事。而且，即便我们明确了共识的生成方式，也不清楚第二个节点为何有动力去验证那个哈希值。该系统的运行机制必须是，节点能够轻松且低成本地改变对近期交易的看法，从而达成共识。但为了实现最终性和不可逆转性，一旦达成共识，并且在旧共识之上叠加了新内容，特别是在旧共识之上又产生了新的比特金，那么要回头改变已做出的决定就会变得极其困难。

说它会那样运行，并不能为我们提供使其那样运行的方法。

> 付款接收方必须等待大约一小时左右，才能相信付款是有效的。到那时，网络会解决任何可能出现的双重花费竞争问题。

你一直在讨论攻击问题。在我还不清楚各方都行为端正时的正常行为是什么样的情况下，我很难去思考如何应对攻击。即便是所有数据库都完全遵从单一所有者的意愿，分布式数据库也依然是件棘手的事。消息会丢失，链接会中断，同步延迟会变得异常，整台机器可能会崩溃，而整个网络必须从容应对所有这些情况。即便在完全没有攻击的情况下，想清楚如何做到这一点也很困难。只有当我们弄清楚如何处理所有这些情况后，才能去考虑攻击问题。

## 芬尼：新颖的想法，我也很好奇
发件人：哈尔·芬尼
主题：比特币点对点电子现金论文
日期：2008 年 11 月 13 日 16:24:18
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014848.html)

> 詹姆斯・A・唐纳德写道：
> > 中本聪写道：
> > 当同一笔交易存在多个双重花费版本时，只有其中一个会生效。
> 这不是我要问的问题。我担心的不是信任问题，而是即便所有人都行为端正，如何才能形成一个全球共享的视图。关于如何达成 “谁拥有哪些比特金代币” 这一全球共享视图的过程，描述得不够详尽。

我认同，对于这些问题的处理方式，相关描述确实不够清晰。中本聪曾提出，发布源代码或许是阐明设计的最佳方式。我自己尝试梳理细节时发现，相关规则确实相当复杂，而且要明确其行为，至少需要一种伪代码算法。所以，编写实际代码或许是个不错的办法。我发现有一个为比特金创建的 SourceForge 项目，不过目前还没有任何代码。

针对詹姆斯提出的具体问题，即由于广播不完善，不同节点看到不同的交易集时会发生什么，我的理解如下。每个节点必须准备好维护多个可能的 “候选” 区块链，其中每个候选链最终都有可能成为最长的链，也就是胜出的链。一旦某条区块链比其他竞争链足够长，较短的链就可以被删除。这种长度差异是一个参数，它取决于节点的威胁模型，即攻击者能调动多少计算能力（以占 “诚实” P2P 网络工作能力的比例来衡量），这一点在论文中有所估计。其核心思想是，一旦一条链落后最长链足够多，它基本上就没有机会再追上来了。

为了解决詹姆斯提出的问题，我认为节点有必要为每个候选链维护一个单独的待处理交易列表。这个列表将包含节点接收到的所有交易（通过交易方广播获得），但这些交易尚未被纳入该区块链中。在任何时候，节点都在努力扩展最长的区块链，而它努力寻找哈希碰撞的区块将包含与该链相关的所有待处理交易。

我认为，通过这种方式，当某个候选链因比最长链短太多而被删除时，其中的交易并不会丢失，而是会继续存在于最长链的待处理交易列表中（在那些接收到原始交易广播的节点中）。（我也考虑过，节点是否应该将从其他节点的区块中得知的交易添加到自己的待处理交易列表中，即便那些区块最终没有进入最长链，但我不确定这是否有必要或有帮助。）

一旦这些规则得到阐明，更正式的建模将有助于理解在可靠性不完善的情况下网络的行为。例如，如果平均有 f 比例的 P2P 节点接收到某笔交易的广播，那么我认为，在该交易出现在最终会成为最长链的链条中之前，可能需要经过 1/f 个区块创建时间。人们或许还会问，鉴于 P2P 网络广播本身的可靠性并不完善，一个节点平均需要同时跟踪多少条候选链？或者正如詹姆斯早些时候提出的，如果网络广播是可靠的，但依赖于一种可能较慢的泛洪算法，这会对性能产生怎样的影响？

> 詹姆斯・A・唐纳德写道：
> 除此之外，我们还需要每个人都有动机去以能达成共识的方式行事。当我不知道需要被激励的行为是什么时，我就看不出他们有什么动机。

我对动机的担忧相对较少。如果该系统能满足以下标准，我就会感到满意：
1. 若其他参与者是诚实的，那么任何单个节点运营商，或者仅控制整体网络资源一小部分的少数节点运营商集合，都无法有效作弊。
2. 节点运营商的 “长尾” 足够庞大，以至于任何少数节点集合都无法控制超过整体资源的一小部分。（此处的 “尾部” 指的是根据每个运营商所控制的资源量进行的排名。）
3. 比特币系统最终被证明具有社会实用性和价值，这样节点运营商会觉得自己的努力为世界做出了有益的贡献（类似于各种 “@Home” 计算项目，在这些项目中，人们自愿贡献自己的计算资源用于公益事业）。在这种情况下，在我看来，单纯的利他主义就足以让网络正常运行。

> 詹姆斯・A・唐纳德写道：
> 即便是所有数据库都完全遵循单一所有者的意愿，分布式数据库也是极具挑战性的。消息会丢失，链路会中断，同步延迟会变得异常，整台机器可能会崩溃，但整个网络必须从容应对这一切。

这是一个非常好的观点，要理解网络会如何应对诸如此类的缺陷，就需要更完整的规范。我期待看到更多细节的呈现。

我想提一点，在很多方面，比特币包含两个相互独立的理念：一是解决詹姆斯在此列出的这类问题的方法，即创建一个全球一致但去中心化的数据库；二是将其用于一个类似魏戴（Wei Dai）的 b-money（论文中有所提及）的系统，但该系统是基于交易 / 代币的，而非基于账户的。正如詹姆斯所强调的，解决全球范围内大规模去中心化的数据库问题，可以说是更难的部分。在我看来，将工作量证明（proof-of-work）用作实现这一目标的工具，是一个新颖的想法，非常值得进一步研究。

## 中本聪：工作量证明是解决拜占庭将军问题的方案
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 13 日 22:56:55（UTC）
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/11/)

> 詹姆斯・A・唐纳德写道：
> 仅仅每个人都知道 X 是不够的。我们还需要每个人都知道每个人都知道 X，并且每个人都知道每个人都知道每个人都知道 X——这就如同拜占庭将军问题一样，是分布式数据处理中一个典型的难题。

工作量证明链是拜占庭将军问题的一种解决方案。我会尝试结合这个场景来重新阐述它。

一群拜占庭将军每人都有一台电脑，他们想要通过暴力破解密码的方式攻击国王的无线网络，而且他们已经得知这个密码有特定的字符长度。一旦他们刺激网络生成一个数据包，就必须在有限的时间内破解密码，以便侵入并删除日志，否则他们就会被发现并陷入麻烦。只有当大多数将军同时发起攻击时，他们所拥有的 CPU 算力才足以快速破解密码。

**他们并不特别在意攻击的具体时间，只希望所有人能达成一致**。大家决定，任何想发起攻击的人都可以宣布一个时间，而最先被听到的那个时间将成为官方的攻击时间。问题在于，网络传输并非即时的，如果两位将军在相近的时间宣布了不同的攻击时间，那么有些人可能会先听到其中一个，而另一些人则可能先听到另一个。

他们采用工作量证明链来解决这个问题。每位将军在收到自己最先听到的攻击时间后，就会让自己的电脑去解决一个极其困难的工作量证明问题，这个问题的哈希中包含了该攻击时间。这个工作量证明的难度极大，预计所有将军一起运算大约 10 分钟，才会有一个人找到解决方案。一旦有一位将军找到了工作量证明，他就会将其广播到整个网络，之后每个人都会调整自己当前的工作量证明计算，在自己正在运算的哈希中纳入这个工作量证明。如果有人之前在为不同的攻击时间进行运算，他们会转而采用这个新的攻击时间，因为此时这个攻击时间对应的工作量证明链更长了。

两小时后，某个攻击时间应该会被一条包含 12 个工作量证明的链条进行哈希运算。每位将军只需验证工作量证明链的难度，就能估算出每小时在这条链上投入了多少并行 CPU 算力，进而发现要在规定时间内完成这么多工作量证明，必然需要大多数电脑的参与。由于工作量证明是他们参与过运算的证据，所以他们肯定都已经知晓了这个攻击时间。如果工作量证明链所展现出的 CPU 算力足以破解密码，那么他们就可以在约定的时间安全地发起攻击。

工作量证明链正是解决你所问到的所有同步、分布式数据库以及全局视图问题的方法。

## 中本聪答芬尼：关于交易池优化
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 14 日 18:55:35
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/12/)

> 哈尔・芬尼写道：
> 我认为，节点有必要为每个候选链保留一个单独的待处理交易列表。…… 人们可能还会问…… 平均而言，一个给定的节点在同一时间必须跟踪多少个候选链？

幸运的是，只需要为当前最佳分支维护一个待处理交易池。当最佳分支有新块到达时，ConnectBlock 会从待处理交易池中移除该块包含的交易。如果另一个不同的分支变得更长，系统会对主分支从分叉点向下调用 DisconnectBlock，将这些块的交易放回待处理交易池，然后对新分支调用 ConnectBlock，从而处理掉两个分支中都存在的交易。预计像这样的重组（reorgs）会很少见，且影响范围较浅。

通过这种优化，候选分支实际上不会带来任何负担。它们只是存储在磁盘上，除非有朝一日成为主链，否则无需关注。

> 哈尔・芬尼写道：
> 或者正如詹姆斯早些时候提出的，如果网络广播是可靠的，但依赖于一种可能较慢的泛洪算法，那么这会对性能产生怎样的影响？

广播很可能会几乎完全可靠。如今，TCP 传输很少会丢失，而且广播协议有重试机制，过一段时间后会从其他节点获取数据。如果实际上广播比预期的要慢，可能就得增加区块之间的目标时间，以避免浪费资源。我们希望区块的传播时间通常远少于生成它们所需的时间，否则节点会在过时的区块上花费过多时间。我计划运行一个自动化测试，让计算机之间随机发送支付，并随机丢弃数据包。

> 哈尔・芬尼写道：
> 事实证明，比特币系统具有社会实用性和价值，因此节点运营商觉得他们通过自己的努力为世界做出了有益的贡献（类似于各种 “@Home” 计算项目，在这些项目中，人们自愿贡献自己的计算资源用于公益事业）。在这种情况下，在我看来，单纯的利他主义就足以使网络正常运行。

如果我们能恰当地解释清楚，这对自由意志主义的观点来说会很有吸引力。不过，比起文字表达，我更擅长写代码。

## 雷·迪林格：我按照我的理解来总结一下这个协议
发件人：雷·迪林格
主题：比特币点对点电子现金论文
日期：2008 年 11 月 15 日 02:20:23
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014857.html)

好的…… 我会按照我的理解来总结这个协议。我会补充一些论文中没有提到的操作细节，结合你所写的内容以及我自己的 “设计直觉”，补充那些我认为关键的缺失部分或 “显而易见” 的使用方法。

首先，人们耗费计算机算力来创建一个可用作货币的硬币池。每一枚硬币都是一种工作量证明，符合其创建时有效的货币标准。创建时间（以及相应的标准）在之后是可验证的，因为人们可以在交易链中看到这枚特定硬币的出现，并通过其所有 “共识视图” 中的花费来追踪它（关于与添加链接相关的硬币创建，后面会有更多说明）。

当一枚硬币被花费时，买方和卖方会对一份（经过盲化处理的）交易记录进行数字签名，并将其广播到一群节点，这些节点的作用是记录硬币所有权的共识。如果有人进行双重花费，那么这份交易记录可以被去盲化，从而揭露作弊者的身份。这是通过一种相当标准的 “切割选择” 算法来实现的：买方用秘密份额回应多个挑战，然后卖方要求买方 “去盲化” 并检查除了其中一个之外的所有内容，验证这些内容确实包含秘密份额，且其中任意两个都足以识别买方。在这种情况下，卖方会接受这份去盲化的花费记录，认为它 “很可能” 包含有效的秘密份额。

负责记录硬币所有权共识的节点处于一个循环中，它们都在努力向自己目前收到的最长链 “添加一个链接”。它们有一个已报告但尚未出现在 “共识” 签名链中的交易池，我将其称为 “池 A”。它们试图通过以下方式向链中添加一个链接：将池 A 中的所有内容移到一个 “池 L” 中，然后使用一种计算密集型的数字签名算法对包含新块 L 的链进行签名。这样一来，链就会被一个包含池 L 中所有交易记录以及该节点数字签名的块所延长。在它们进行这项工作时，新的交易记录会不断到达，并再次进入池 A，用于下一轮工作。

在工作过程中，它们可能还会收到与自己正试图延长的链长度相同的链，其中最后几个 “链接” 与它们正在处理的链中的链接并不相同。它们会忽略这些链。（？它们真的会忽略吗？考虑到基于这些链的更长链会包含它们，在什么情况下需要再次查看这些链呢？）但是，如果在工作过程中收到一条更长的链，它们会立即检查新链接中的所有交易，确保没有双重花费，并且所有新链接的 “工作量因子” 都是适当的。如果其中包含双重花费，它们会创建一个作为双重花费证明的 “交易”，将其添加到池 A 中，进行广播，然后继续工作。如果其中一个 “新” 链接的工作量因子不适当（即，根据规则，某人投入的算力不足，使其不 “合法”），就会创建一个作为该链接创建节点违反协议证明的新 “交易”，进行广播并添加到池 A 中，同时拒绝该链。如果没有双重花费，且所有未见过的链接的工作量因子都适当，它们就会接受这条新链作为共识。

如果新链被接受，它们就会放弃添加当前正在处理的链接，将池 L 中的所有交易放回池 A（连同开始工作后收到或创建的交易），从池 A 中剔除那些已经是新链中某个链接一部分的交易记录，然后再次开始努力延长这条新链。如果它们完成了添加新链接以延长链的工作，就会广播这条链，并立即开始处理池 A 中自开始工作以来积累的所有交易，以添加另一个新链接。我的理解对吗？

最大的技术问题：是否有机制确保 “链” 不仅仅由 3 到 4 个最快的节点添加的链接组成？因为一条广播的交易记录很容易漏掉这 3 到 4 个节点，如果出现这种情况，而这些节点继续主导链，那么该交易可能永远不会被添加进去。为了解决这个问题，要么需要确保交易的可证明传播，要么需要根据某个节点自上次添加链接以来新增的链接数量来调整该节点的工作量因子。不幸的是，这两种措施都可能被 “傀儡节点” 破解。这可能是你当前协议最严重的问题；你需要一个中心点来控制节点的身份（密钥），防止人们创建新的傀儡节点。

可证明传播意味着，当鲍勃从爱丽丝那里接受一条新链时，他需要确保爱丽丝已经（或获取了）他的 “池 A” 和 “池 L” 中的所有交易。他会发送这些交易，爱丽丝则返回一个签名哈希以证明她已收到。一旦爱丽丝收到了这组交易，如果之后任何包含爱丽丝添加的链接的链没有在该链接处或之前包含这些交易，那么鲍勃应该能够发布他发送给爱丽丝的区块以及她的签名，作为爱丽丝违反协议的证明。但傀儡节点会破解这一点，因为爱丽丝只需使用新密钥对后续链进行签名，假装是一个不同的节点即可。

如果我们根据新增链接的数量来调整工作量因子，那么我们又会回到由 3 到 4 个最快节点主导的局面，只不过现在它们会联合大约 600 个左右的傀儡节点，以避免工作量因子的惩罚。

如果我们解决了傀儡节点的问题，或者接受有一个中心点来控制新密钥的生成，那么硬币的生成就应该与成功向 “共识” 链添加区块的行为绑定在一起。这很容易实现：创建一枚硬币就是一笔交易，它会和区块中的所有其他交易一起被添加进去。但每个链接只能创建一枚硬币，当然，如果你的链版本没有被接受，那么在 “被接受” 的视图中，你就没有这枚硬币，也无法花费它。这给了维护共识数据库的人们耗费算力的理由，特别是因为根据自上次添加链接以来新增的链接数量而产生的工作量因子差异（如上文所述），确保了每个人，而不仅仅是 3 到 4 个最快的节点，偶尔都有机会创建硬币。

此外，向链中添加一个链接的工作量要求应该（再次呈指数级）随着前一周该链新增的链接数量而变化，从而严格控制硬币的生成速度（进而控制通货膨胀）。

为了实现规模化，你需要硬币聚合。需要有一种 “可证明的” 交易，例如，某人收回 10 枚单币，然后创建一枚面额为 10 的新币，等等。利用你已有的基础设施，这并不难实现；它只需成为链的一部分，当该链被接受为共识时，所有人都能看到这一过程。

## 中本聪答迪林格：你的理解偏差太大，等我代码发布
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 15 日世界协调时间 04:43:00
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/13/)

我会尽快发布源代码，作为参考来帮助澄清所有这些实现问题。

> 雷・迪林格写道：
> 当硬币花费时，买卖双方以数字方式签署（盲）交易记录。

只有买家签字，没有盲人。

> 雷・迪林格写道：
> 如果有人双花，那么交易记录可以揭开骗子的身份。

身份不被使用，也不依赖追索权。这都是预防。

> 雷・迪林格写道：
> 这是通过一个相当标准的剪切和选择买家应对多个挑战的算法秘密股份

没有挑战或秘密分享。一个基本的交易只是你在第 2 节的图中看到的。满足上一次交易公钥的（买方的）签名，以及必须满足下一次花费它的新公钥（卖方的）。

> 雷・迪林格写道：
> 他们也可能收到链子，只要他们想收到的链子。在它们工作时扩展，其中最后几个 “链接” 是链接与他们工作的链条 _ 不 _ 相同。他们忽略了这些。

对，如果长度相等，保留收到的最早的领带就可以打破领带。

> 雷・迪林格写道：
> 如果它包含双花，那么他们会创建一个 “交易”这是双重支出的证明，将其添加到他们的池 A 中，广播它，并继续工作。

没有必要像那样报告 “双重支出证明”。如果同一条链包含两个支出，则该块无效并被拒绝。

如果一个块没有足够的工作量证明也是如此。该块无效并被拒绝。没有必要分发有关它的报告。每个节点都可以看到它并在中继之前拒绝它。

如果有两条相互竞争的链，每条链都包含同一交易的不同版本，一条试图把钱给一个人，另一条试图把同样的钱给另一个人，那么解决哪个支出是有效的就是整个工作量证明链的意义所在。

我们不是在 “寻找” 双花来敲响警钟并抓住骗子。我们只是判断其中一个支出是有效的。交易的接收者必须等待几个区块，以确保解决方案有时间完成。作弊者可以尝试同时双花他们想要的，他们所做的只是在几个区块内，其中一个支出变得有效，其他支出变得无效。一旦主链中已经有支出，任何后来的双花都会立即被拒绝。

即使之前的支出还没有在链中，如果它已经在所有节点的池中，那么第二次支出将被所有已经有第一次支出的节点拒绝。

> 雷・迪林格写道：
> 如果新链被接受，那么他们就放弃添加他们的当前链接，将池 L 中的所有交易转储回池 A（以及他们从那以后收到或创建的交易开始工作），从池 A 中删除那些交易记录已经是新链中链接的一部分，并开始工作，再次尝试扩展新链。

没错。每当有新事务进来时，它们也会刷新，所以 L 几乎一直包含 A 中的所有内容。

> 雷・迪林格写道：
> CPU 密集型数字签名算法签署包含新区块 L 的链。

这是一个 Hashcash 风格的 SHA-256 工作量证明（零的部分预映像），而不是签名。

> 雷・迪林格写道：
> 是否有机制确保 “链” 不包含仅由 3 或 4 个最快的节点添加的链接？因为广播交易记录很容易错过这 3 或 4 个节点。如果是这样，并且这些节点继续主导链，则交易可能永远不会被添加。

如果您将其视为 CPU 密集型数字签名，那么您可能会考虑首先完成长时间操作并且最快的总是获胜的比赛。

工作量证明是 Hashcash 风格的 SHA-256 冲突查找。这是一个无记忆的过程，您每秒执行数百万个哈希，每次找到一个的机会很小。3 或 4 个最快节点的优势仅与它们在总 CPU 能力中的份额成正比。任何人在任何时候找到解决方案的机会都与他们的 CPU 能力成正比。

会有交易费用，因此节点将有动力接收并包含他们可以接收的所有交易。当创建的总硬币达到预定上限时，节点最终将仅通过交易费用获得补偿。

> 雷・迪林格写道：
> 此外，向链添加链接的工作要求应随着添加到该链接的数量而变化（再次呈指数级）上周上链，造成代币率（因此通货膨胀）要严格控制。

是的。

> 雷・迪林格写道：
> 您需要硬币聚合才能扩展。需要有一个 “可证明的” 交易，其中有人退回十个硬币，并创建一个面额为 10 等的新硬币。

每笔交易都是其中之一。第 9 节，合并和拆分价值

## 雷·迪林格：追问匿名性与结算时间
发件人：雷·迪林格
主题：比特币点对点电子现金论文
日期：2008 年 11 月 15 日世界协调时间 07:04:21
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014859.html)

> 2008 年 11 月 15 日（周六）12:43 +0800，中本聪写道：
> 我会尽快发布源代码，以作为参考，帮助解答所有这些实现方面的问题。
> > 雷・迪林格（贝尔）写道：
> > 当一枚硬币被花费时，买方和卖方会对一份（经过盲化处理的）交易记录进行数字签名。只有买方会签名，而且不存在盲化处理。如果有人进行双重花费，那么这份交易记录可以被去盲化，从而揭露作弊者的身份。这里不涉及身份，也不依赖追索权。一切都靠预防。
>

好的，这很令人惊讶。如果你不使用买家 / 卖家身份，那么你就不会去核实一笔支出是否确实是由该 coins（数字货币）的所有者（记录中显示的接收者）进行的。有三类身份值得我们思考。
第一类：公开身份。现实世界的身份有记录可查，并与每一笔交易相关联。
第二类：pseudonymous（假名）身份。系统内存在持久的 “身份”，人们可以看出某件事是否是由做过另一件事的同一个假名所做，但不一定有办法将这些假名与现实世界的身份联系起来。
第三类：不可关联的匿名身份。不存在身份的概念，无论是持久的还是其他形式的。没有人能够说明或证明任何交易中涉及的主体与其他任何交易中涉及的主体是否为同一主体。

你似乎在声称是第三类，还是第二类呢？很多人不会区分匿名协议和假名协议，所以有必要明确问一下你的意思。不管怎样，我会假设你所说的意思几乎（反正就我能想象到的程度而言）是不可关联的匿名。这意味着，代替 “身份”，支出者必须证明自己知晓一个只有该 coins 的真正所有者才知道的秘密。实现这一点的一种方法是，让接收 coins 的人生成一对非对称密钥，然后将其中一半与交易一起公开。之后要支出该 coins 时，他 / 她必须证明自己拥有这对非对称密钥的另一半，很可能是通过用它对新卖家提供的密钥进行签名来证明。所以我们无法证明任何关于 “身份” 的事情，但我们可以证明，该 coins 的支出者是知晓接收该 coins 的人所知道的那个秘密的人。
而你接下来所说的内容似乎证实了这一点：

> 没有挑战或秘密共享。一笔基本交易就像你在第 2 节的图中看到的那样。（买家的）签名要与上一笔交易的公钥相匹配，还有一个新的（卖家的）公钥，下次要花费这笔交易时，就必须与这个新公钥相匹配。

请注意，尽管这本身并不涉及身份问题，但它仍然会使进行花费操作的代理与之前接收该代币的代理产生关联，因此这些交易是可关联的。为了抵消这一点，代币的所有者需要进行一笔交易，这笔交易在其他人看来与任何正常交易毫无区别，在该交易中，所有者创建一个新的密钥对，并将代币转移给其持有者（即，让一个 “傀儡” 将代币 “花费” 给另一个 “傀儡”）。所有者的现实世界身份不会发生变化，但与花费该代币的代理 “可关联” 的交易不再具有关联性。对于第三类不可关联性，这一操作必须进行随机次数——也许是 1 到 6 次？顺便说一句，你能不能学会使用换行符？你的文字一直傻乎乎地向右滚动，我得滚动屏幕才能看清你在说什么，然后在回复之前还得编辑添加换行符。

> 如果其中包含双重花费，那么他们会创建一个 “交易”，作为双重花费的证明，将其添加到自己的池 A 中，进行广播，然后继续工作。
> 没必要像那样专门报告 “双重花费证明”。如果同一条链中包含了两次花费，那么这个区块就是无效的，会被拒绝。
> 区块如果没有足够的工作量证明，情况也是一样。这样的区块是无效的，会被拒绝。没必要对此传播相关报告。每个节点都能发现这种情况，并在转发之前就将其拒绝。

嗯。我不确定这样是否妥当。你是说，没有努力去识别和排除那些不合作的节点吗？我怀疑这会带来麻烦，还可能引发拒绝服务攻击。

> 如果存在两条相互竞争的链，每条链都包含同一笔交易的不同版本，其中一条链试图将资金转给一个人，而另一条链试图将相同的资金转给另一个人，那么判定哪笔支出有效，正是整个工作量证明链的意义所在。

好的，当你说 “相同的” 交易，而你谈论的是那些明显不同的交易时，你指的是双花，对吗？用同一个密钥签名的两笔交易？

> 我们并非在 “警惕” 双重支付以发出警报并抓住作弊者。我们只是裁定哪一笔支付是有效的。交易接收方必须等待几个区块，以确保相关决议有足够时间完成。

直到…… 直到什么时候？人们怎么知道一笔交易何时变得不可撤销？“几个” 区块是指 3 个？30 个？还是 100 个？这取决于节点的数量吗？它与节点数量成对数关系还是线性关系？

> 潜在的作弊者可以随心所欲地尝试同时进行多次双重花费，但他们所能做到的不过是，在几个区块内，其中一次花费会生效，而其他的则会失效。

但在没有身份的情况下，如果支出变得无效，对他们来说并没有什么损失，只要他们已经收到了通过双重支付所获得的商品（比如网站访问权限、下载内容等）。商家就会被这些 “无效” 的货币困住，除非他们等待那神奇的 “几个区块”（而且他们怎么知道是多少个呢？），之后才把支付者视为已经付款。
如果消费者花了钱，却要等一个小时才能完成结算，才能使用他们花钱购买的东西，他们是不会愿意的。如果商家发现由于客户进行了双重支付而导致收到的货币无效，却没有办法向客户退款，他们也不会愿意这么做。

> 即便较早的一笔支出尚未进入区块链，但如果它已经存在于所有节点的交易池中，那么那些已经有了第一笔支出记录的节点就会拒绝第二笔支出。

因此，当最初同时进行的支出广播相互干扰时，存在及早发现的可能性。我在此假设广播是由卖家进行的，因为买家可能不愿意广泛传播支出信息。

> 如果新的链条被接受，那么他们就会放弃添加自己当前的区块…… 并重新开始努力扩展这条新的链条。
> > 是的。每当有新交易进入时，他们也会进行更新，所以 L 几乎一直包含 A 中的所有内容。

好的，这与以下两种工作量证明之间存在很大差异：一种是需要大量固定数量 CPU 周期的工作量证明，另一种是只需少量 CPU 周期但成功概率极低的工作量证明。你可以在工作过程中更改数据集，而且这并不意味着你需要重新开始。在这种情况下，这一点很有利，因为这意味着没有人必须将最近收到的交易排除在他们正在处理的链路之外。

> 有没有一种机制可以确保 “链条” 不会仅仅由 3 到 4 个速度最快的节点所添加的链接组成？
> 如果你把它看作是一种计算密集型的数字签名，那么你可能会认为这是一场谁先完成冗长操作的竞赛，而速度最快的节点总会获胜。

没错。这就是我之前一直有的误解。再说一次，区别在于一种是需要大量 CPU 周期的证明，另一种是只需少量 CPU 周期但成功概率极低的证明。

> 任何人在任何时候找到解决方案的概率都与他们的 CPU 算力成正比。

这就像是工作难度中的随机变化，通过这种方式，它会对你有利。

> 将会有交易手续费，因此节点会有动力接收并包含它们所能处理的所有交易。当创建的硬币总量达到预先设定的上限时，节点最终将仅通过交易手续费获得补偿。

我不明白 “交易费” 会如何运作，以及资金如何从进行交易的代理方流转到运行网络的节点方。但如果向链条中添加一个链接能让节点创建一个代币，那么其经济效果是相同的（尽管在某种程度上是随机的），所以我会坚持这一点。此外，需要注意的是，在任何时候，不同节点的计算能力预计会有两个数量级的差异。

## 中本聪答雷·迪林格：解释 ECC 与即时交易风险
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 15 日 18:02:00
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/14/)

> 雷・迪林格写道：
> 一种实现方式是让接收硬币的人生成一个非对称密钥对，然后将其中一半与交易一同发布。之后要花费这枚硬币时，他 / 她必须证明拥有该非对称密钥对的另一半，或许可以通过用它对新卖家提供的密钥进行签名来实现。

没错，这就是椭圆曲线加密（ECC）数字签名。每笔交易都会使用新的密钥对。

从 nyms（假名）标识人的角度来说，这并非匿名，但从某种程度上也算是有一点匿名性，因为硬币的下一次操作可以被识别为来自该硬币的所有者。

> 嗯，我对此不太确定。你是说不会尝试识别并排除不合作的节点吗？我怀疑这会带来麻烦，还可能引发分布式拒绝服务（DOS）攻击。

我们不依赖于识别任何人。正如你所说，识别他人是徒劳的，而且很容易被 “傀儡账号” 破解。证明一个人是真实存在的凭证是其提供 CPU 算力的能力。

> 直到…… 直到什么时候？人们怎么知道一笔交易何时变得不可撤销？“几个” 区块是 3 个？30 个？还是 100 个？这取决于节点数量吗？与节点数量成对数关系还是线性关系？

第 11 节计算了遭受攻击时的最坏情况。通常情况下，5 个或 10 个区块就足够了。如果卖家所售物品不值得攻击者发动网络规模的攻击来窃取，实际上可以再少等几个区块。

> 但是，在没有身份标识的情况下，如果花费变得无效，而他们已经收到了通过双重花费获得的商品（网站访问权限、下载内容等），他们不会有任何损失。商家则会陷入困境，持有 “无效” 的硬币，除非他们等待那个神奇的 “几个区块”（而且他们怎么知道要等多少个呢）之后，才认定付款人已经付款。
> 如果消费者花了硬币，却要等一个小时才能完成结算，才能使用花了钱买到的东西，他们是不会接受的。如果商家发现由于客户进行了双重花费导致收到的硬币无效，却无法向客户追回款项，他们也不会接受这种方式。

这是一个 2.0 版本需要解决的问题，我相信对于大多数应用场景，这个问题都能得到相当令人满意的解决。

关键在于让你的交易首先在网络上传播开来。可以想象成六度分隔理论——交易传播是呈指数级的。一笔交易大约只需 2 分钟就能传播到足够广泛的范围，以至于后来发起的竞争性交易几乎没机会在第一个交易覆盖整个网络之前抢占太多节点。

在这 2 分钟内，商家的节点可以监控是否有双重花费交易。双重花费者无法在不被商家察觉的情况下，将其替代交易广而告之，所以他必须等待一段时间再发起。
如果真实交易覆盖了 90% 的节点，而双重花费交易只覆盖了 10%，那么双重花费者不付款的概率只有 10%，而他的钱被花出去的概率则有 90%。对于几乎所有类型的商品来说，欺诈者这么做都得不偿失。

像网站访问权限或下载内容这类信息类商品是难以销赃的。没人能靠窃取网站访问权限或下载内容为生。他们大可以去文件共享网络窃取这些东西。大多数即时访问的产品并没有太大的窃取动机。

如果商家确实面临盗窃问题，他们可以让客户等待 2 分钟，或者通过电子邮件等方式发送，很多商家已经在这么做了。如果他们真想优化，对于大型下载，要是发现交易存在双重花费，他们可以中途取消下载。如果是网站访问权限，通常让客户访问 5 分钟，要是交易被拒绝再切断访问也没什么大不了的。很多这类网站本身就提供免费试用。

## 唐纳德：网络可靠性的挑战
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 16 日世界标准时间 24:00:04
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014861.html)

> 中本聪写道：
> 幸运的是，只需要为当前最佳分支保留一个待处理交易池。

这就要求我们知道——也就是说，一个通信和数据存储都正常工作的诚实、行为良好的节点知道——当前的最佳分支是什么。但当然，问题在于我们正试图发现、试图达成一个最佳分支，这在最好的情况下也并非易事，而当另一个节点在其连接性和能力方面撒谎，还有一个节点刚因软件崩溃而掩盖了严重的磁盘故障，以及连接第三个节点的国际光纤遭到恐怖分子攻击时，情况就变得更加困难了。

> 当一个新的区块加入最佳分支时，ConnectBlock 会将该区块中的交易从待处理交易池中移除。如果另一个不同的分支变得更长

这前提是这些分支存在，并且它们是完全明确和完整的。如果它们作为完整的成果存在，而非仍在进行中的工作，那么这个问题就已经解决了，因为问题在于取得进展。

> 广播很可能会几乎完全可靠。

及时性和可靠性之间存在一种权衡。如果时间无关紧要，人们可以让广播的可靠性达到任意高的程度。然而，当涉及分布式数据时，时间总是至关重要的，因为这一切都与同步有关（即节点需要在相应的时间拥有相应的视图），所以在进行分布式数据处理时，广播总是极不可靠的。为确保每条消息至少到达一次所做的尝试，会导致时间变化增大。因此，人们必须制定一种要么是 UDP，要么在某种程度上类似 UDP 的协议，其特点是消息体积小、消息无法到达的情况很常见、消息到达的顺序可能与发送顺序不同，而且同一条消息可能多次到达。我们要么使用 UDP，要么需要在 TCP 连接之上处理与 UDP 相同的问题。我们不应假设每条消息至少到达一次，而必须构建一种机制，确保即便承载信息的消息频繁无法到达，信息本身仍能送达。

> 如今，TCP 传输很少会丢失。

人们总是将连接负载接近最大值。当连接接近最大值时，TCP 连接会频繁遭遇不合理的长时间延迟，而且连接经常直接中断——你最喜欢的网络漫画不知为何一直显示正在加载，于是你重试；或者图片位置出现一个小叉号，你也会重试。此外，极长的连接——例如通过 FTP 下载大文件——很少能完成。如果你试图通过 FTP 传输一部电影，除非客户端和服务器都具备断点续传机制，能够处理部分下载的文件，否则你很可能无法成功。
UDP 连接，例如 Skype 视频通话，也会频繁出现画面冻结、画质下降等问题，因此必须具备无论出现何种情况都能继续运行的机制。

> 如果我们能恰当地解释清楚，这对自由意志主义的观点会很有吸引力。不过比起文字，我更擅长代码。

不，如果我们能设计出一种机制，使其能够扩展到在互联网上为大量人群提供快速不可逆支付的好处，且不受政治干预，那对自由意志主义者来说会非常有吸引力。
你对这样的设计有一个框架和提议，这是很大的进步，但细节决定成败。我真的应该把你的提议充实完善，而不是一直催促你填补那些盲区。

## 中本聪答唐纳德：完整版代码马上就来
发件人：中本聪
主题：比特币点对点电子现金论文
日期：2008 年 11 月 17 日 17:24:43
原文：[Bitcoin P2P e-cash paper \| Satoshi Nakamoto Institute](https://satoshi.nakamotoinstitute.org/emails/cryptography/15/)

> 詹姆斯・A・唐纳德写道：
> 幸运的是，只需要为当前最佳分支保留一个待处理交易池。
> 这就要求我们知道，也就是说，一个诚实、行为良好且通信和数据存储正常运行的节点知道，当前的最佳分支是什么。

我的意思是，一个节点只需要为它所拥有的最佳分支准备未确认交易池。也就是它当前认为是最佳的那个分支。节点会尝试基于这个分支来创建区块，这也是它需要这个交易池的全部用途。

> 广播很可能会几乎完全可靠。
> 我们不必假设每条消息至少到达一次，而是必须构建一种机制，确保即便所传递的消息经常无法到达，信息也能成功送达。

我想我已经搞清楚了对等网络的广播机制。每个节点会向其邻居发送一份包含它所拥有的新区块和交易的哈希值的清单。邻居们会请求它们尚未拥有的项目。如果在超时后仍未收到该项目，它们会向另一个拥有该项目的邻居请求。由于所有或大多数邻居最终都应该拥有每个项目，即使与其中一个的通信出现问题，它们也可以依次尝试从其他任何一个邻居那里获取。

这种清单 - 请求 - 数据的方案会引入一些延迟，但它通过将额外的数据块从传输队列中移除并节省带宽，最终有助于提高速度。

> 你已经有了这样一个设计的大纲和提案，这是向前迈出的一大步，但细节决定成败。

我相信，在过去一年半的编码过程中，我已经处理好了所有那些小细节，而且这样的细节有很多。论文中没有涵盖功能方面的细节，但源代码很快就会发布。我已经把主要文件发给你了。（目前可应请求提供，完整版很快发布）

## 威廉姆斯：身份有啥用了
发件人：尼古拉斯·威廉姆斯
主题：比特币点对点电子现金论文
日期：2008 年 11 月 17 日世界协调时间 21:54:28
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014864.html)

2008 年 11 月 14 日，星期五，晚上 11:04:21（西八区时间），雷・迪林格写道：
> 2008 年 11 月 15 日，星期六，中午 12:43（东八区时间），
> > 中本聪写道：
> > 如果有人进行双重支付，那么交易记录可以被解密，从而揭露欺诈者的身份。这里不使用身份，也不依赖追索权。一切都在于预防。
>
> 好的，这很令人惊讶。如果不使用买家 / 卖家的身份，那么就无法核实进行支付的人是否确实是所花费代币的所有者（记录中显示已收到该代币的人）。

身份有什么用呢？它本该是匿名现金，对吧？而且，就算你事后识别出了双重花费者，那又能怎样呢？或许你看到的只是一个一次性的身份。又或许你根本无法追踪到他们。双重花费检测需要是实时的或者接近实时的。

## 唐纳德：评迪林格方案与效率
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 17 日 23:57:39（世界协调时间）
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014865.html)

雷・迪林格写道：
> 好的…… 我将按照我的理解来总结这个协议。我会补充一些论文中没有提及的操作细节，具体方式是在你所写内容的基础上，补充上我自己的 “设计直觉” 告诉我是关键缺失部分或 “显而易见” 的使用方法。

实现这一点有许多明显不同的方法。我一直在基于帕特里夏哈希树开发自己的版本（目前还未准备好发布，大约一周后会发布），其中共识生成是对使用默克尔哈希树进行文件共享的一种推广。在帕特里夏哈希树中，帕特里夏密钥的高位部分代表时间的高位部分，这种树可用于共享随时间演变的数据。如果该算法由诚实且正常运行的节点来实现，它会定期生成近期的共识哈希——从而解决我一直抱怨的问题，即我们虽然有机制来防止不诚实或出现故障的节点对共识造成干扰，但如果没有诚实且正常运行的节点生成共识的定义，这种机制就毫无用处。

> 首先，人们耗费计算能力创建一个可作为货币使用的货币池。每一枚货币都是一种工作量证明，符合其创建时生效的任何货币标准。创建时间（以及相应的标准）日后是可核查的，因为人们可以在交易链中看到这枚特定货币的出现，并通过其所有 “共识视图” 的花费情况对其进行追踪。（关于与添加链接相关的货币创建，稍后会有更多说明。）
>
> 当一枚货币被花费时，买方和卖方会对（经过盲化处理的）交易记录进行数字签名，并将其广播到多个节点，这些节点的作用是跟踪货币所有权的共识情况。

我认为你的盲化处理行不通。如果存在谁拥有哪些代币的公开记录，我们就必须针对该记录的变更生成公开的差异信息，这样记录就会显示某一代币曾属于 X，不久之后又属于了 Y。我觉得盲化处理无法实现。我们倒是可以很容易地对交易细节进行盲化，只需将细节的哈希值公开即可（比如 X 向 Y 支付了 49vR7xmwYcKXt9zwPJ943h9bHKC2pG68m），但 X 向 Y 支付这一事实还是会相当明显。

如果乔给我花了一个代币，那我必须要有能力去确认 “乔是否合法拥有这个代币”，但在分布式协议中，要做到这一点却很难不让人们有机会通过浏览数据发现是乔给我付了钱。

为了就谁拥有哪些代币达成共识，谁拥有哪些代币的信息必须是公开的。

我们可以在此基础上构建一个隐私层——基于比特金代币的账户货币和乔姆货币，就像 1915 年之前的美国银行系统在金币之上构建了账户货币和银行票据一样。事实上，我们也必须在现有基础上再构建一个层级，以将交易成本降低到足以支持代理进行微交易的水平，这对于带宽控制、文件共享以及向非白名单用户收取发送通信费用等场景来说是必需的。

因此，公开记录中的实体就如同 1915 年之前的银行一样运作——我们称之为 “binks”，因为 1934 年之后的银行不再是那样运作了。

> 但是，如果他们在工作时收到一个更长的链条，他们会立即检查新链接中的所有交易，以确保其中没有双重花费，并且所有新链接的 “工作因子” 都是合适的

我感到困扰的是，这涉及到对那些已基本为人所知的数据进行频繁的重传。关于比特金所有权的共识以及广泛传播的看法本身就已经带来了高昂的成本。此外，每次数据传输都可能出现数据丢失的情况，这可能导致系统抖动，还存在共识生成速度可能慢于新交易产生速度的风险。我们目前已经面临这样一个问题：难以将成本降低到足以支持软件代理进行微交易的水平，而微交易所针对的正是一个巨大的未被满足的市场——带宽控制、文件共享以及向非白名单用户收取发送通信的费用。

要成为一个有用的项目，就必须尽可能提高效率——因此我计划使用帕特里夏哈希树，因为它能够识别并定位那些大体上已达成一致的节点之间的细微差异，而无需这些节点传输完整的数据。我们还希望避免出现需要频繁检查以验证内容的超长哈希链。任何时候，当一条哈希链随着时间推移有可能变得极长时，我们必须确保没有人需要重新遍历其全部长度。那些需要重新遍历的链，其长度增长只能与交易总数的对数成正比——如果它们的增长是某一时间段内交易数量的对数加上时间段的总数，那我们就会遇到问题。

> 最大的技术问题：
> 是否有一种机制可以确保 “链” 不会仅由 3 个或 4 个速度最快的节点所添加的链接组成？因为广播的交易记录很容易漏掉这 3 个或 4 个节点，而如果出现这种情况，且这些节点继续主导链条，那么该交易可能永远不会被添加进去。
> 为了解决这个问题，你需要要么确保交易的可验证传播，要么根据自节点最近添加的链接以来已添加的链接数量来改变节点的工作量系数。
> 不幸的是，这两种措施都可能被傀儡账户（sock puppets）破解。就目前而言，这可能是你的协议最严重的问题；你需要某个中心点来控制节点的身份（密钥），并防止人们创建新的傀儡账户

我们需要这样一个协议：要成为一个资金追踪节点（即验证支出的实体），你必须得到至少两个现有节点的认可，这些节点同意与你同步数据——这可能是通过现有节点所有者的人为干预来实现的，而且这两条经人为批准的同步路径会通过至少一个图循环，间接地将你与网络中的其他节点连接起来。

如果节点 X 仅通过一个现有节点 Y 连接到网络的其他部分，或许是因为 X 的直接连接节点已经退出，那么 X 就会被降级为客户端，而非节点——X 提交的任何交易都会被 Y 重新标记为是提交给 Y 的，而非提交给 X 的，并且提交时间（这是帕特里夏密钥的一部分）是 X 提交给 Y 的时间，而非提交给 X 的时间。

该算法必须能够迅速检测出出现故障的节点，并自动将其暂时排除在共识之外——这意味着通过故障节点提交的交易不会被纳入共识，因此必须重新提交，而且节点可能会发现自己被暂时降级为客户端，因为它们以前通过其连接到网络的某个节点已被共识排除在外。

如果一个节点多次被自动暂时排除，与其直接交换数据的那些节点的所有者可能会进行人为干预，将其永久移除。

由于节点是通过人为邀请获得认可的，它们有声誉可失，因此我们可以做出零假设（主要的贝叶斯先验）：节点具有诚实的意图、有效的数据，但数据传输不可靠——这种信任需要偶尔进行随机验证。基于这一基础设计系统会大大降低处理成本。

回想一下，SET 之所以失败，很大程度上是因为每笔交易都涉及无数的公钥操作。同样，HTTPS 存在巨大的安全漏洞，因为它有太多冗余的公钥操作，以至于网站设计者试图将 HTTPS 的使用范围最小化，只覆盖那些真正需要的领域——但他们在判断哪些领域真正需要 HTTPS 时，总会出现微妙的错误。

效率至关重要，特别是对于那些尚未被服务到的市场，即低成本交易市场。

> 如果我们解决了傀儡账号的问题，或者接受存在一个控制点来管理新密钥的生成

一个中心点会招致攻击，也必将遭到攻击。计算机网络货币存在的问题是，过去的交易很容易被修改，因此节点会面临调整过往交易的压力——“我没有支付那笔钱” 会迅速变成 “我本不该支付那笔钱”，这就需要仲裁，而仲裁成本高昂，还会带来不确定性（这同样代价不菲），并引发政府监管，而政府监管很可能具有毁灭性的破坏力。

在很多情况下，交易的撤销和仲裁是非常可取的，但没有人能与维萨（Visa）和万事达（Mastercard）提供的仲裁服务相抗衡，因为它们拥有网络效应，而且在仲裁方面做得非常出色，具备丰富的经验、积累的技能、智慧和良好的声誉。因此，任何新的网络交易系统都必须瞄准对最终且不可逆转的交易的需求。

分布式网络共识的理念是，在众多司法管辖区内存在大量的节点，一旦一笔交易进入共识，要撤销它几乎是不可能的——这需要向大多数司法管辖区的大多数节点施压，让它们同意撤销，而其中许多节点甚至听不懂你的语言，那些听得懂的，很可能也会装作听不懂。所以人们根本不会去尝试。

为了避免受到压力，网络必须避免出现任何可能被施加压力的中心点。回想一下尼禄的愿望：他希望罗马有一个喉咙，这样他就能一刀切断。如果我们给他们提供这样一个 “喉咙”，那它终将被切断。

## 唐纳德：主张使用 UDP 协议
发件人：詹姆斯·A·唐纳德
主题：比特币点对点电子现金论文
日期：2008 年 11 月 18 日 01:26:31
原文：[Bitcoin P2P e-cash paper](http://www.metzdowd.com/pipermail/cryptography/2008-November/014866.html)

> 尼古拉斯・威廉姆斯写道：
> 身份有什么帮助呢？它应该是匿名现金，对吧？实际上并非如此。不过，它应该是匿名的，所以损害某人的声誉并没有多大帮助。

实际上并非如此。不过，它本应是匿名 的，因此损害某人的声誉仍然没什么用。

> 而且假设你事后发现了一个双重花费者，那又能怎样呢？或许你面对的是一个一次性身份。又或许你根本无法追踪到他们。
> 双重花费检测需要是实时的或接近实时的。

近实时意味着我们必须使用 UDP 或类似协议，而不是 TCP 或类似协议，并且我们必须达成近似共识，不一定是最终共识，也不一定是完全一致的协议，而是接近共识，且往返次数要在合理的少量范围内。
